(function(m){var y=m.Markdown=function y(R){switch(typeof R){case"undefined":this.dialect=y.dialects.Gruber;break;case"object":this.dialect=R;break;default:if(R in y.dialects){this.dialect=y.dialects[R]}else{throw new Error("Unknown Markdown dialect '"+String(R)+"'")}break}this.em_state=[];this.strong_state=[];this.debug_indent=""};m.parse=function(T,R){var S=new y(R);return S.toTree(T)};m.toHTML=function O(U,R,T){var S=m.toHTMLTree(U,R,T);return m.renderJsonML(S)};m.toHTMLTree=function P(U,S,V){if(typeof U==="string"){U=this.parse(U,S)}var R=n(U),W={};if(R&&R.references){W=R.references}var T=g(U,W,V);z(T);return T};function C(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function B(){var R=require("util");return"Markdown.mk_block( "+R.inspect(this.toString())+", "+R.inspect(this.trailing)+", "+R.inspect(this.lineNumber)+" )"}var A=y.mk_block=function(R,U,S){if(arguments.length==1){U="\n\n"}var T=new String(R);T.trailing=U;T.inspect=B;T.toSource=C;if(S!=undefined){T.lineNumber=S}return T};function h(T){var S=0,R=-1;while((R=T.indexOf("\n",R+1))!==-1){S++}return S}y.prototype.split_blocks=function M(S,W){var V=/([\s\S]+?)($|\n(?:\s*\n|$)+)/g,R=[],U;var T=1;if((U=/^(\s*\n)/.exec(S))!=null){T+=h(U[0]);V.lastIndex=U[0].length}while((U=V.exec(S))!==null){R.push(A(U[1],U[2],T));T+=h(U[0])}return R};y.prototype.processBlock=function F(R,U){var S=this.dialect.block,V=S.__order__;if("__call__" in S){return S.__call__.call(this,R,U)}for(var T=0;T<V.length;T++){var W=S[V[T]].call(this,R,U);if(W){if(!v(W)||(W.length>0&&!(v(W[0])))){this.debug(V[T],"didn't return a proper array")}return W}}return[]};y.prototype.processInline=function G(R){return this.dialect.inline.__call__.call(this,String(R))};y.prototype.toTree=function Q(V,T){var S=V instanceof Array?V:this.split_blocks(V);var U=this.tree;try{this.tree=T||this.tree||["markdown"];S:while(S.length){var R=this.processBlock(S.shift(),S);if(!R.length){continue S}this.tree.push.apply(this.tree,R)}return this.tree}finally{if(T){this.tree=U}}};y.prototype.debug=function(){var R=Array.prototype.slice.call(arguments);R.unshift(this.debug_indent);if(typeof print!=="undefined"){print.apply(print,R)}if(typeof console!=="undefined"&&typeof console.log!=="undefined"){console.log.apply(null,R)}};y.prototype.loop_re_over_block=function(V,S,T){var U,R=S.valueOf();while(R.length&&(U=V.exec(R))!=null){R=R.substr(U[0].length);T.call(this,U)}return R};y.dialects={};y.dialects.Gruber={block:{atxHeader:function b(R,U){var T=R.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(!T){return undefined}var S=["header",{level:T[1].length}];Array.prototype.push.apply(S,this.processInline(T[2]));if(T[0].length<R.length){U.unshift(A(R.substr(T[0].length),R.trailing,R.lineNumber+2))}return[S]},setextHeader:function K(R,V){var U=R.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(!U){return undefined}var T=(U[2]==="=")?1:2;var S=["header",{level:T},U[1]];if(U[0].length<R.length){V.unshift(A(R.substr(U[0].length),R.trailing,R.lineNumber+2))}return[S]},code:function f(S,U){var W=[],V=/^(?: {0,3}\t| {4})(.*)\n?/,T;if(!S.match(V)){return undefined}block_search:do{var R=this.loop_re_over_block(V,S.valueOf(),function(X){W.push(X[1])});if(R.length){U.unshift(A(R,S.trailing));break block_search}else{if(U.length){if(!U[0].match(V)){break block_search}W.push(S.trailing.replace(/[^\n]/g,"").substring(2));S=U.shift()}else{break block_search}}}while(true);return[["code_block",W.join("\n")]]},horizRule:function q(R,U){var T=R.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(!T){return undefined}var S=[["hr"]];if(T[1]){S.unshift.apply(S,this.processBlock(T[1],[]))}if(T[3]){U.unshift(A(T[3]))}return S},lists:(function(){var S="[*+-]|\\d+\\.",T=/[*+-]/,Y=/\d+\./,X=new RegExp("^( {0,3})("+S+")[ \t]+"),W="(?: {0,3}\\t| {4})";function aa(ab){return new RegExp("(?:^("+W+"{0,"+ab+"} {0,3})("+S+")\\s+)|(^"+W+"{0,"+(ab-1)+"}[ ]{0,4})")}function U(ab){return ab.replace(/ {0,3}\t/g,"    ")}function R(af,ag,ad,ah){if(ag){af.push(["para"].concat(ad));return}var ab=af[af.length-1] instanceof Array&&af[af.length-1][0]=="para"?af[af.length-1]:af;if(ah&&af.length>1){ad.unshift(ah)}for(var ac=0;ac<ad.length;ac++){var ai=ad[ac],ae=typeof ai=="string";if(ae&&ab.length>1&&typeof ab[ab.length-1]=="string"){ab[ab.length-1]+=ai}else{ab.push(ai)}}}function V(ad,ac){var ae=new RegExp("^("+W+"{"+ad+"}.*?\\n?)*$"),af=new RegExp("^"+W+"{"+ad+"}","gm"),ag=[];while(ac.length>0){if(ae.exec(ac[0])){var ab=ac.shift(),ah=ab.replace(af,"");ag.push(A(ah,ab.trailing,ab.lineNumber))}break}return ag}function Z(ae,ab,af){var ad=ae.list;var ac=ad[ad.length-1];if(ac[1] instanceof Array&&ac[1][0]=="para"){return}if(ab+1==af.length){ac.push(["para"].concat(ac.splice(1)))}else{var ag=ac.pop();ac.push(["para"].concat(ac.splice(1)),ag)}}return function(ab,aq){var ao=ab.match(X);if(!ao){return undefined}function ap(ay){var ax=T.exec(ay[2])?["bulletlist"]:["numberlist"];av.push({list:ax,indent:ay[1]});return ax}var av=[],am=ap(ao),ah,an=false,au=[av[0].list],af;loose_search:while(true){var al=ab.split(/(?=\n)/);var ai="";tight_search:for(var aj=0;aj<al.length;aj++){var at="",ag=al[aj].replace(/^\n/,function(ax){at=ax;return""});var ak=aa(av.length);ao=ag.match(ak);if(ao[1]!==undefined){if(ai.length){R(ah,an,this.processInline(ai),at);an=false;ai=""}ao[1]=U(ao[1]);var aw=Math.floor(ao[1].length/4)+1;if(aw>av.length){am=ap(ao);ah.push(am);ah=am[1]=["listitem"]}else{var ad=false;for(af=0;af<av.length;af++){if(av[af].indent!=ao[1]){continue}am=av[af].list;av.splice(af+1);ad=true;break}if(!ad){aw++;if(aw<=av.length){av.splice(aw);am=av[aw-1].list}else{am=ap(ao);ah.push(am)}}ah=["listitem"];am.push(ah)}at=""}if(ag.length>ao[0].length){ai+=at+ag.substr(ao[0].length)}}if(ai.length){R(ah,an,this.processInline(ai),at);an=false;ai=""}var ac=V(av.length,aq);if(ac.length>0){o(av,Z,this);ah.push.apply(ah,this.toTree(ac,[]))}var ar=aq[0]&&aq[0].valueOf()||"";if(ar.match(X)||ar.match(/^ /)){ab=aq.shift();var ae=this.dialect.block.horizRule(ab,aq);if(ae){au.push.apply(au,ae);break}o(av,Z,this);an=true;continue loose_search}break}return au}})(),blockquote:function e(S,W){if(!S.match(/^>/m)){return undefined}var U=[];if(S[0]!=">"){var V=S.split(/\n/),Y=[];while(V.length&&V[0][0]!=">"){Y.push(V.shift())}S=V.join("\n");U.push.apply(U,this.processBlock(Y.join("\n"),[]))}while(W.length&&W[0][0]==">"){var R=W.shift();S=new String(S+S.trailing+R);S.trailing=R.trailing}var T=S.replace(/^> ?/gm,""),X=this.tree;U.push(this.toTree(T,["blockquote"]));return U},referenceDefn:function I(T,U){var V=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(!T.match(V)){return undefined}if(!n(this.tree)){this.tree.splice(1,0,{})}var R=n(this.tree);if(R.references===undefined){R.references={}}var S=this.loop_re_over_block(V,T,function(W){if(W[2]&&W[2][0]=="<"&&W[2][W[2].length-1]==">"){W[2]=W[2].substring(1,W[2].length-1)}var X=R.references[W[1].toLowerCase()]={href:W[2]};if(W[4]!==undefined){X.title=W[4]}else{if(W[5]!==undefined){X.title=W[5]}}});if(S.length){U.unshift(A(S,T.trailing))}return[]},para:function E(R,S){return[["para"].concat(this.processInline(R))]}}};y.dialects.Gruber.inline={__oneElement__:function D(X,T,U){var S,W,R=0;T=T||this.dialect.inline.__patterns__;var V=new RegExp("([\\s\\S]*?)("+(T.source||T)+")");S=V.exec(X);if(!S){return[X.length,X]}else{if(S[1]){return[S[1].length,S[1]]}}var W;if(S[2] in this.dialect.inline){W=this.dialect.inline[S[2]].call(this,X.substr(S.index),S,U||[])}W=W||[S[2].length,S[2]];return W},__call__:function s(V,T){var S=[],U;function R(W){if(typeof W=="string"&&typeof S[S.length-1]=="string"){S[S.length-1]+=W}else{S.push(W)}}while(V.length>0){U=this.dialect.inline.__oneElement__.call(this,V,T,S);V=V.substr(U.shift());o(U,R)}return S},"]":function(){},"}":function(){},"\\":function k(R){if(R.match(/^\\[\\`\*_{}\[\]()#\+.!\-]/)){return[2,R[1]]}else{return[1,"\\"]}},"![":function r(T){var S=T.match(/^!\[(.*?)\][ \t]*\([ \t]*(\S*)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(S){if(S[2]&&S[2][0]=="<"&&S[2][S[2].length-1]==">"){S[2]=S[2].substring(1,S[2].length-1)}S[2]=this.dialect.inline.__call__.call(this,S[2],/\\/)[0];var R={alt:S[1],href:S[2]||""};if(S[4]!==undefined){R.title=S[4]}return[S[0].length,["img",R]]}S=T.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/);if(S){return[S[0].length,["img_ref",{alt:S[1],ref:S[2].toLowerCase(),original:S[0]}]]}return[2,"!["]},"[":function x(aa){var Y=String(aa);var Z=y.DialectHelpers.inline_until_char.call(this,aa.substr(1),"]");if(!Z){return[1,"["]}var T=1+Z[0],S=Z[1],V,R;aa=aa.substr(T);var W=aa.match(/^\s*\([ \t]*(\S+)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(W){var ab=W[1];T+=W[0].length;if(ab&&ab[0]=="<"&&ab[ab.length-1]==">"){ab=ab.substring(1,ab.length-1)}if(!W[3]){var X=1;for(var U=0;U<ab.length;U++){switch(ab[U]){case"(":X++;break;case")":if(--X==0){T-=ab.length-U;ab=ab.substring(0,U)}break}}}ab=this.dialect.inline.__call__.call(this,ab,/\\/)[0];R={href:ab||""};if(W[3]!==undefined){R.title=W[3]}V=["link",R].concat(S);return[T,V]}W=aa.match(/^\s*\[(.*?)\]/);if(W){T+=W[0].length;R={ref:(W[1]||String(S)).toLowerCase(),original:Y.substr(0,T)};V=["link_ref",R].concat(S);return[T,V]}if(S.length==1&&typeof S[0]=="string"){R={ref:S[0].toLowerCase(),original:Y.substr(0,T)};V=["link_ref",R,S[0]];return[T,V]}return[1,"["]},"<":function c(S){var R;if((R=S.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))!=null){if(R[3]){return[R[0].length,["link",{href:"mailto:"+R[3]},R[3]]]}else{if(R[2]=="mailto"){return[R[0].length,["link",{href:R[1]},R[1].substr("mailto:".length)]]}else{return[R[0].length,["link",{href:R[1]},R[1]]]}}}return[1,"<"]},"`":function u(S){var R=S.match(/(`+)(([\s\S]*?)\1)/);if(R&&R[2]){return[R[1].length+R[2].length,["inlinecode",R[3]]]}else{return[1,"`"]}},"  \n":function w(R){return[3,["linebreak"]]}};function N(V,S){var U=V+"_state",T=V=="strong"?"em_state":"strong_state";function R(W){this.len_after=W;this.name="close_"+S}return function(ad,Z){if(this[U][0]==S){this[U].shift();return[ad.length,new R(ad.length-S.length)]}else{var aa=this[T].slice(),ac=this[U].slice();this[U].unshift(S);var ab=this.processInline(ad.substr(S.length));var Y=ab[ab.length-1];var W=this[U].shift();if(Y instanceof R){ab.pop();var X=ad.length-Y.len_after;return[X,[V].concat(ab)]}else{this[T]=aa;this[U]=ac;return[S.length,S]}}}}y.dialects.Gruber.inline["**"]=N("strong","**");y.dialects.Gruber.inline.__=N("strong","__");y.dialects.Gruber.inline["*"]=N("em","*");y.dialects.Gruber.inline._=N("em","_");y.buildBlockOrder=function(R){var T=[];for(var S in R){if(S=="__order__"||S=="__call__"){continue}T.push(S)}R.__order__=T};y.buildInlinePatterns=function(R){var V=[];for(var T in R){if(T.match(/^__.*__$/)){continue}var U=T.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");V.push(T.length==1?U:"(?:"+U+")")}V=V.join("|");R.__patterns__=V;var S=R.__call__;R.__call__=function(X,W){if(W!=undefined){return S.call(this,X,W)}else{return S.call(this,X,V)}}};y.DialectHelpers={};y.DialectHelpers.inline_until_char=function(U,V){var R=0,S=[];while(true){if(U[R]==V){R++;return[R,S]}if(R>=U.length){return null}var T=this.dialect.inline.__oneElement__.call(this,U.substr(R));R+=T[0];S.push.apply(S,T.slice(1))}};y.subclassDialect=function(S){function R(){}R.prototype=S.block;function T(){}T.prototype=S.inline;return{block:new R(),inline:new T()}};y.buildBlockOrder(y.dialects.Gruber.block);y.buildInlinePatterns(y.dialects.Gruber.inline);y.dialects.Maruku=y.subclassDialect(y.dialects.Gruber);y.dialects.Maruku.processMetaHash=function H(U){var T=L(U),R={};for(var S=0;S<T.length;++S){if(/^#/.test(T[S])){R.id=T[S].substring(1)}else{if(/^\./.test(T[S])){if(R["class"]){R["class"]=R["class"]+T[S].replace(/./," ")}else{R["class"]=T[S].substring(1)}}else{if(/\=/.test(T[S])){var V=T[S].split(/\=/);R[V[0]]=V[1]}}}}return R};function L(U){var T=U.split(""),V=[""],R=false;while(T.length){var S=T.shift();switch(S){case" ":if(R){V[V.length-1]+=S}else{V.push("")}break;case"'":case'"':R=!R;break;case"\\":S=T.shift();default:V[V.length-1]+=S;break}}return V}y.dialects.Maruku.block.document_meta=function j(R,U){if(R.lineNumber>1){return undefined}if(!R.match(/^(?:\w+:.*\n)*\w+:.*$/)){return undefined}if(!n(this.tree)){this.tree.splice(1,0,{})}var V=R.split(/\n/);for(p in V){var T=V[p].match(/(\w+):\s*(.*)$/),S=T[1].toLowerCase(),W=T[2];this.tree[1][S]=W}return[]};y.dialects.Maruku.block.block_meta=function d(T,W){var V=T.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(!V){return undefined}var R=this.dialect.processMetaHash(V[2]);var U;if(V[1]===""){var X=this.tree[this.tree.length-1];U=n(X);if(typeof X==="string"){return undefined}if(!U){U={};X.splice(1,0,U)}for(a in R){U[a]=R[a]}return[]}var S=T.replace(/\n.*$/,""),Y=this.processBlock(S,[]);U=n(Y[0]);if(!U){U={};Y[0].splice(1,0,U)}for(a in R){U[a]=R[a]}return Y};y.dialects.Maruku.block.definition_list=function i(S,Y){var aa=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,W=["dl"],V;if((X=S.match(aa))){var T=[S];while(Y.length&&aa.exec(Y[0])){T.push(Y.shift())}for(var R=0;R<T.length;++R){var X=T[R].match(aa),Z=X[1].replace(/\n$/,"").split(/\n/),U=X[2].split(/\n:\s+/);for(V=0;V<Z.length;++V){W.push(["dt",Z[V]])}for(V=0;V<U.length;++V){W.push(["dd"].concat(this.processInline(U[V].replace(/(\n)\s+/,"$1"))))}}}else{return undefined}return[W]};y.dialects.Maruku.inline["{:"]=function t(Y,V,X){if(!X.length){return[2,"{:"]}var S=X[X.length-1];if(typeof S==="string"){return[2,"{:"]}var U=Y.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!U){return[2,"{:"]}var W=this.dialect.processMetaHash(U[1]),R=n(S);if(!R){R={};S.splice(1,0,R)}for(var T in W){R[T]=W[T]}return[U[0].length,""]};y.buildBlockOrder(y.dialects.Maruku.block);y.buildInlinePatterns(y.dialects.Maruku.inline);var v=Array.isArray||function(R){return Object.prototype.toString.call(R)=="[object Array]"};var o;if(Array.prototype.forEach){o=function(R,S,T){return R.forEach(S,T)}}else{o=function(R,S,U){for(var T=0;T<R.length;T++){S.call(U||R,R[T],T,R)}}}function n(R){return v(R)&&R.length>1&&typeof R[1]==="object"&&!(v(R[1]))?R[1]:undefined}m.renderJsonML=function(S,T){T=T||{};T.root=T.root||false;var R=[];if(T.root){R.push(J(S))}else{S.shift();if(S.length&&typeof S[0]==="object"&&!(S[0] instanceof Array)){S.shift()}while(S.length){R.push(J(S.shift()))}}return R.join("\n\n")};function l(R){return R.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function J(U){if(typeof U==="string"){return l(U)}var V=U.shift(),S={},T=[];if(U.length&&typeof U[0]==="object"&&!(U[0] instanceof Array)){S=U.shift()}while(U.length){T.push(arguments.callee(U.shift()))}var W="";for(var R in S){W+=" "+R+'="'+l(S[R])+'"'}if(V=="img"||V=="br"||V=="hr"){return"<"+V+W+"/>"}else{return"<"+V+W+">"+T.join("")+"</"+V+">"}}function g(Z,Y,W){var T;W=W||{};var U=Z.slice(0);if(typeof W.preprocessTreeNode==="function"){U=W.preprocessTreeNode(U,Y)}var R=n(U);if(R){U[1]={};for(T in R){U[1][T]=R[T]}R=U[1]}if(typeof U==="string"){return U}switch(U[0]){case"header":U[0]="h"+U[1].level;delete U[1].level;break;case"bulletlist":U[0]="ul";break;case"numberlist":U[0]="ol";break;case"listitem":U[0]="li";break;case"para":U[0]="p";break;case"markdown":U[0]="html";if(R){delete R.references}break;case"code_block":U[0]="pre";T=R?2:1;var S=["code"];S.push.apply(S,U.splice(T));U[T]=S;break;case"inlinecode":U[0]="code";break;case"img":U[1].src=U[1].href;delete U[1].href;break;case"linebreak":U[0]="br";break;case"link":U[0]="a";break;case"link_ref":U[0]="a";var X=Y[R.ref];if(X){delete R.ref;R.href=X.href;if(X.title){R.title=X.title}delete R.original}else{return R.original}break;case"img_ref":U[0]="img";var X=Y[R.ref];if(X){delete R.ref;R.src=X.href;if(X.title){R.title=X.title}delete R.original}else{return R.original}break}T=1;if(R){for(var V in U[1]){T=2}if(T===1){U.splice(T,1)}}for(;T<U.length;++T){U[T]=arguments.callee(U[T],Y,W)}return U}function z(S){var R=n(S)?2:1;while(R<S.length){if(typeof S[R]==="string"){if(R+1<S.length&&typeof S[R+1]==="string"){S[R]+=S.splice(R+1,1)[0]}else{++R}}else{arguments.callee(S[R]);++R}}}})((function(){if(typeof exports==="undefined"){window.markdown={};return window.markdown}else{return exports}})());