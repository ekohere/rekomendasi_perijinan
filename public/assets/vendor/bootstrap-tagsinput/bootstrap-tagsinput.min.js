(function(a){var b={tagClass:function(j){return"label label-info"},focusClass:"focus",itemValue:function(j){return j?j.toString():j},itemText:function(j){return this.itemValue(j)},itemTitle:function(j){return null},freeInput:true,addOnBlur:true,maxTags:undefined,maxChars:undefined,confirmKeys:[13,44],delimiter:",",delimiterRegex:null,cancelConfirmKeysOnEmpty:false,onTagExists:function(k,j){j.hide().fadeIn()},trimValue:false,allowDuplicates:false,triggerChange:true};function i(j,k){this.isInit=true;this.itemsArray=[];this.$element=a(j);this.$element.hide();this.isSelect=(j.tagName==="SELECT");this.multiple=(this.isSelect&&j.hasAttribute("multiple"));this.objectItems=k&&k.itemValue;this.placeholderText=j.hasAttribute("placeholder")?this.$element.attr("placeholder"):"";this.inputSize=Math.max(1,this.placeholderText.length);this.$container=a('<div class="bootstrap-tagsinput"></div>');this.$input=a('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container);this.$element.before(this.$container);this.build(k);this.isInit=false}i.prototype={constructor:i,add:function(r,o,x){var y=this;if(y.options.maxTags&&y.itemsArray.length>=y.options.maxTags){return}if(r!==false&&!r){return}if(typeof r==="string"&&y.options.trimValue){r=a.trim(r)}if(typeof r==="object"&&!y.objectItems){throw ("Can't add objects when itemValue option is not set")}if(r.toString().match(/^\s*$/)){return}if(y.isSelect&&!y.multiple&&y.itemsArray.length>0){y.remove(y.itemsArray[0])}if(typeof r==="string"&&this.$element[0].tagName==="INPUT"){var n=(y.options.delimiterRegex)?y.options.delimiterRegex:y.options.delimiter;var s=r.split(n);if(s.length>1){for(var q=0;q<s.length;q++){this.add(s[q],true)}if(!o){y.pushVal(y.options.triggerChange)}return}}var v=y.options.itemValue(r),t=y.options.itemText(r),z=y.options.tagClass(r),u=y.options.itemTitle(r);var p=a.grep(y.itemsArray,function(A){return y.options.itemValue(A)===v})[0];if(p&&!y.options.allowDuplicates){if(y.options.onTagExists){var j=a(".tag",y.$container).filter(function(){return a(this).data("item")===p});y.options.onTagExists(r,j)}return}if(y.items().toString().length+r.length+1>y.options.maxInputLength){return}var m=a.Event("beforeItemAdd",{item:r,cancel:false,options:x});y.$element.trigger(m);if(m.cancel){return}y.itemsArray.push(r);var l=a('<span class="tag '+d(z)+(u!==null?('" title="'+u):"")+'">'+d(t)+'<span data-role="remove"></span></span>');l.data("item",r);y.findInputWrapper().before(l);l.after(" ");var w=(a('option[value="'+encodeURIComponent(v)+'"]',y.$element).length||a('option[value="'+d(v)+'"]',y.$element).length);if(y.isSelect&&!w){var k=a("<option selected>"+d(t)+"</option>");k.data("item",r);k.attr("value",v);y.$element.append(k)}if(!o){y.pushVal(y.options.triggerChange)}if(y.options.maxTags===y.itemsArray.length||y.items().toString().length===y.options.maxInputLength){y.$container.addClass("bootstrap-tagsinput-max")}if(a(".typeahead, .twitter-typeahead",y.$container).length){y.$input.typeahead("val","")}if(this.isInit){y.$element.trigger(a.Event("itemAddedOnInit",{item:r,options:x}))}else{y.$element.trigger(a.Event("itemAdded",{item:r,options:x}))}},remove:function(l,k,m){var n=this;if(n.objectItems){if(typeof l==="object"){l=a.grep(n.itemsArray,function(o){return n.options.itemValue(o)==n.options.itemValue(l)})}else{l=a.grep(n.itemsArray,function(o){return n.options.itemValue(o)==l})}l=l[l.length-1]}if(l){var j=a.Event("beforeItemRemove",{item:l,cancel:false,options:m});n.$element.trigger(j);if(j.cancel){return}a(".tag",n.$container).filter(function(){return a(this).data("item")===l}).remove();a("option",n.$element).filter(function(){return a(this).data("item")===l}).remove();if(a.inArray(l,n.itemsArray)!==-1){n.itemsArray.splice(a.inArray(l,n.itemsArray),1)}}if(!k){n.pushVal(n.options.triggerChange)}if(n.options.maxTags>n.itemsArray.length){n.$container.removeClass("bootstrap-tagsinput-max")}n.$element.trigger(a.Event("itemRemoved",{item:l,options:m}))},removeAll:function(){var j=this;a(".tag",j.$container).remove();a("option",j.$element).remove();while(j.itemsArray.length>0){j.itemsArray.pop()}j.pushVal(j.options.triggerChange)},refresh:function(){var j=this;a(".tag",j.$container).each(function(){var k=a(this),l=k.data("item"),n=j.options.itemValue(l),m=j.options.itemText(l),p=j.options.tagClass(l);k.attr("class",null);k.addClass("tag "+d(p));k.contents().filter(function(){return this.nodeType==3})[0].nodeValue=d(m);if(j.isSelect){var o=a("option",j.$element).filter(function(){return a(this).data("item")===l});o.attr("value",n)}})},items:function(){return this.itemsArray},pushVal:function(){var j=this,k=a.map(j.items(),function(l){return j.options.itemValue(l).toString()});j.$element.val(k,true);if(j.options.triggerChange){j.$element.trigger("change")}},build:function(j){var k=this;k.options=a.extend({},b,j);if(k.objectItems){k.options.freeInput=false}h(k.options,"itemValue");h(k.options,"itemText");g(k.options,"tagClass");if(k.options.typeahead){var l=k.options.typeahead||{};g(l,"source");k.$input.typeahead(a.extend({},l,{source:function(t,r){function s(v){var x=[];for(var u=0;u<v.length;u++){var w=k.options.itemText(v[u]);q[w]=v[u];x.push(w)}r(x)}this.map={};var q=this.map,p=l.source(t);if(a.isFunction(p.success)){p.success(s)}else{if(a.isFunction(p.then)){p.then(s)}else{a.when(p).then(s)}}},updater:function(p){k.add(this.map[p]);return this.map[p]},matcher:function(p){return(p.toLowerCase().indexOf(this.query.trim().toLowerCase())!==-1)},sorter:function(p){return p.sort()},highlighter:function(q){var p=new RegExp("("+this.query+")","gi");return q.replace(p,"<strong>$1</strong>")}}))}if(k.options.typeaheadjs){var m=null;var n={};var o=k.options.typeaheadjs;if(a.isArray(o)){m=o[0];n=o[1]}else{n=o}k.$input.typeahead(m,n).on("typeahead:selected",a.proxy(function(q,p){if(n.valueKey){k.add(p[n.valueKey])}else{k.add(p)}k.$input.typeahead("val","")},k))}k.$container.on("click",a.proxy(function(p){if(!k.$element.attr("disabled")){k.$input.removeAttr("disabled")}k.$input.focus()},k));if(k.options.addOnBlur&&k.options.freeInput){k.$input.on("focusout",a.proxy(function(p){if(a(".typeahead, .twitter-typeahead",k.$container).length===0){k.add(k.$input.val());k.$input.val("")}},k))}k.$container.on({focusin:function(){k.$container.addClass(k.options.focusClass)},focusout:function(){k.$container.removeClass(k.options.focusClass)},});k.$container.on("keydown","input",a.proxy(function(t){var p=a(t.target),q=k.findInputWrapper();if(k.$element.attr("disabled")){k.$input.attr("disabled","disabled");return}switch(t.which){case 8:if(c(p[0])===0){var v=q.prev();if(v.length){k.remove(v.data("item"))}}break;case 46:if(c(p[0])===0){var u=q.next();if(u.length){k.remove(u.data("item"))}}break;case 37:var s=q.prev();if(p.val().length===0&&s[0]){s.before(q);p.focus()}break;case 39:var r=q.next();if(p.val().length===0&&r[0]){r.after(q);p.focus()}break;default:}var x=p.val().length,y=Math.ceil(x/5),w=x+y+1;p.attr("size",Math.max(this.inputSize,p.val().length))},k));k.$container.on("keypress","input",a.proxy(function(q){var p=a(q.target);if(k.$element.attr("disabled")){k.$input.attr("disabled","disabled");return}var t=p.val(),r=k.options.maxChars&&t.length>=k.options.maxChars;if(k.options.freeInput&&(f(q,k.options.confirmKeys)||r)){if(t.length!==0){k.add(r?t.substr(0,k.options.maxChars):t);p.val("")}if(k.options.cancelConfirmKeysOnEmpty===false){q.preventDefault()}}var u=p.val().length,v=Math.ceil(u/5),s=u+v+1;p.attr("size",Math.max(this.inputSize,p.val().length))},k));k.$container.on("click","[data-role=remove]",a.proxy(function(p){if(k.$element.attr("disabled")){return}k.remove(a(p.target).closest(".tag").data("item"))},k));if(k.options.itemValue===b.itemValue){if(k.$element[0].tagName==="INPUT"){k.add(k.$element.val())}else{a("option",k.$element).each(function(){k.add(a(this).attr("value"),true)})}}},destroy:function(){var j=this;j.$container.off("keypress","input");j.$container.off("click","[role=remove]");j.$container.remove();j.$element.removeData("tagsinput");j.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){var k=this.$input[0],j=this.$container[0];while(k&&k.parentNode!==j){k=k.parentNode}return a(k)}};a.fn.tagsinput=function(j,k,l){var m=[];this.each(function(){var o=a(this).data("tagsinput");if(!o){o=new i(this,j);a(this).data("tagsinput",o);m.push(o);if(this.tagName==="SELECT"){a("option",a(this)).attr("selected","selected")}a(this).val(a(this).val())}else{if(!j&&!k){m.push(o)}else{if(o[j]!==undefined){if(o[j].length===3&&l!==undefined){var n=o[j](k,null,l)}else{var n=o[j](k)}if(n!==undefined){m.push(n)}}}}});if(typeof j=="string"){return m.length>1?m:m[0]}else{return m}};a.fn.tagsinput.Constructor=i;function h(k,j){if(typeof k[j]!=="function"){var l=k[j];k[j]=function(m){return m[l]}}}function g(k,j){if(typeof k[j]!=="function"){var l=k[j];k[j]=function(){return l}}}var e=a("<div />");function d(j){if(j){return e.text(j).html()}else{return""}}function c(k){var j=0;if(document.selection){k.focus();var l=document.selection.createRange();l.moveStart("character",-k.value.length);j=l.text.length}else{if(k.selectionStart||k.selectionStart=="0"){j=k.selectionStart}}return(j)}function f(k,l){var j=false;a.each(l,function(o,p){if(typeof(p)==="number"&&k.which===p){j=true;return false}if(k.which===p.which){var m=!p.hasOwnProperty("altKey")||k.altKey===p.altKey,q=!p.hasOwnProperty("shiftKey")||k.shiftKey===p.shiftKey,n=!p.hasOwnProperty("ctrlKey")||k.ctrlKey===p.ctrlKey;if(m&&q&&n){j=true;return false}}});return j}a(function(){a("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})})(window.jQuery);